#!/usr/bin/env php
<?php
define('MONENGINE', 'Remake by starky');
require_once __DIR__ . "/../include/Provider.php";
require_once __DIR__ . "/../include/CronWorker.php";
require_once __DIR__ . "/../include/Work.php";
require_once __DIR__ . "/../include/Registry.class.php";
require_once __DIR__ . "/../include/Config.class.php";
require_once __DIR__ . "/../include/Database.class.php";
require_once __DIR__ . "/../include/MySQL_Database.class.php";

Registry::_set('config', Config::getInstance());
Registry::_set('database', new MySQL_Database);

require_once __DIR__ . "/../include/function.php";
require_once __DIR__ . "/../include/constants.php";

$query = db()->query("SELECT * FROM " . DB_SERVERS);
$servers = array();
$servers_online = 0;
$sql = array();
$items = array();

while ($r = db()->fetch_array($query)) {
    $items[] = $r;
}

$threads = 32;
$provider = new Provider();

$pool = new Pool($threads, 'CronWorker', [$provider]);
$start = microtime(true);

$workers = $threads;
for ($i = 0; $i < $workers; $i++) {
    $pool->submit(new Work());
}

$pool->shutdown();

printf("Done for %.2f seconds" . PHP_EOL, microtime(true) - $start);
