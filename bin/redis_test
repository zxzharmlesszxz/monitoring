#!/usr/bin/env php
<?php
/**
 * Created by PhpStorm.
 * User: harmless
 * Date: 15.06.17
 * Time: 15:47
 */
define('MONENGINE', 'Remake by starky');
require_once __DIR__ . "/../include/core.php";
$redis = new Redis();
$redis->connect($settings['redis_host']);
$redis->auth($settings['redis_password']);
$redis->select(1);

$items = array();
$query = db()->query("SELECT `server_id`, `server_ip` FROM `" . DB_SERVERS . "`;");

while ($r = db()->fetch_array($query)) {
    $sq = new SourceServerQueries();
    $address = explode(':', $r['server_ip']);
    $sq->connect($address[0], $address[1]);
    $info = $sq->getInfo();
    $players = $sq->getPlayers();
    $rules = $sq->getRules();
    $sq->disconnect();
    $item = array('info' => $info, 'players' => $players, 'rules' => $rules);
    $redis->hSet('servers', $r['server_id'], serialize($item));
}
